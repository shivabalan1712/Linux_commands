# üêö Advanced Shell Scripting 

## üìå 1. Advanced Variables & Parameters

* **Default values**

  ```bash
  echo "${VAR:-default}"   # Use default if VAR unset
  echo "${VAR:=default}"   # Assign default if VAR unset
  ```
* **Substring operations**

  ```bash
  STR="hello_world"
  echo "${STR:0:5}"   # hello
  echo "${STR#*_}"    # world (remove prefix until _)
  echo "${STR%_*}"    # hello (remove suffix after _)
  ```
* **Arrays (indexed & associative)**

  ```bash
  arr=(one two three)
  echo "${arr[1]}"       # two
  declare -A dict
  dict[lang]="bash"
  echo "${dict[lang]}"
  ```

---

## üìå 2. Advanced Control Structures

* **Arithmetic for loops**

  ```bash
  for ((i=0; i<5; i++)); do
      echo "Number $i"
  done
  ```
* **Select menus**

  ```bash
  select opt in Start Stop Quit; do
      case $opt in
          Start) echo "Starting...";;
          Stop)  echo "Stopping...";;
          Quit)  break;;
      esac
  done
  ```

---

## üìå 3. Process & Job Control in Scripts

* **Running in background**

  ```bash
  my_command &
  pid=$!
  wait $pid
  ```
* **Traps & signals**

  ```bash
  trap 'echo "CTRL+C pressed, cleaning up..."; exit 1' SIGINT
  trap 'rm -f /tmp/lockfile' EXIT
  ```

---

## üìå 4. Error Handling & Debugging

* **Exit codes**

  ```bash
  command || { echo "command failed"; exit 1; }
  ```
* **Strict mode**

  ```bash
  set -euo pipefail
  IFS=$'\n\t'
  ```
* **Debugging**

  ```bash
  bash -x script.sh    # Trace execution
  set -x               # Enable debugging
  set +x               # Disable debugging
  ```

---

## üìå 5. Input, Output & Redirection Tricks

* **Redirect all output**

  ```bash
  ./script.sh > out.log 2>&1
  ```
* **Here documents**

  ```bash
  cat <<EOF > file.txt
  Line 1
  Line 2
  EOF
  ```
* **Here strings**

  ```bash
  grep "foo" <<< "foo bar baz"
  ```

---

## üìå 6. Advanced Text Processing

* **Regex with grep**

  ```bash
  grep -E '^[0-9]{3}-[0-9]{2}-[0-9]{4}$' data.txt
  ```
* **sed magic**

  ```bash
  sed -E 's/(foo)(bar)/\2\1/' file.txt   # swap foo and bar
  ```
* **awk one-liners**

  ```bash
  awk '{sum += $2} END {print "Total:", sum}' data.csv
  ```

---

## üìå 7. Functions & Libraries

* **Functions with return codes**

  ```bash
  myfunc() {
      [[ -f "$1" ]] || return 1
      echo "File exists: $1"
  }
  ```
* **Importing libraries**

  ```bash
  source ./utils.sh
  ```

---

## üìå 8. Parallel Execution

* **xargs parallel jobs**

  ```bash
  cat urls.txt | xargs -n 1 -P 4 curl -O
  ```
* **GNU parallel**

  ```bash
  parallel wget ::: http://site1.com/file http://site2.com/file
  ```

---

## üìå 9. Script Portability & Best Practices

* **Shebang best practice**

  ```bash
  #!/usr/bin/env bash
  ```
* **Linting & style**

  ```bash
  shellcheck script.sh
  shfmt -w script.sh
  ```
* **POSIX compliance check**

  ```bash
  dash -n script.sh
  ```

---

## üìå 10. Advanced Scripting Patterns

* **Configuration via env vars**

  ```bash
  : "${PORT:=8080}"   # default 8080 if not set
  ```
* **Lock files**

  ```bash
  exec 200>/tmp/mylock
  flock -n 200 || { echo "Already running"; exit 1; }
  ```
* **Idempotent scripts** (safe to run multiple times)
* **Logging framework**

  ```bash
  log() { echo "$(date +"%F %T") - $*"; }
  ```
